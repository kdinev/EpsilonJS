/*! EpsilonJS 2014-09-19 */
"use strict";!function(){Array.prototype.top=function(){return this[this.length-1]};var a=a||{},b=48,c=57,d=65,e=90,f=46;return a.ExpressionParser=function(g){this.expression=g,this.operatorStack=[],this.valueStack=[],this.parse=function(){for(var g,h,i=this.expression.split(""),j=!1;i.length;)if(g=i.shift(),h=[],"("===g)this.operatorStack.push("("),j=!1;else if(")"===g){for(;"("!==this.operatorStack.top();)this.valueStack.push(new a.ExpressionTree(this.operatorStack.pop(),this.valueStack.pop(),this.valueStack.pop()));this.operatorStack.pop(),j=!0}else if(g.charCodeAt(0)>=b&&g.charCodeAt(0)<=c||g.charCodeAt(0)>=d&&g.charCodeAt(0)<=e||g.charCodeAt(0)===f){for(h.push(g);i.length&&(i[0].charCodeAt(0)>=b&&i[0].charCodeAt(0)<=c||i[0].charCodeAt(0)>=d&&i[0].charCodeAt(0)<=e||i[0].charCodeAt(0)===f);)h.push(i.shift());this.valueStack.push(new a.ExpressionTree(h.join(""))),j=!0}else if("-"!==g||j){if("+"===g||"-"===g||"*"===g||"/"===g){for(;this.operatorStack.length&&("*"===this.operatorStack.top()||"/"===this.operatorStack.top()||("+"===g||"-"===g)&&("+"===this.operatorStack.top()||"-"===this.operatorStack.top()));)this.valueStack.push(new a.ExpressionTree(this.operatorStack.pop(),this.valueStack.pop(),this.valueStack.pop()));this.operatorStack.push(g),j=!1}}else{for(;i.length&&(i[0].charCodeAt(0)>=b&&i[0].charCodeAt(0)<=c||i[0].charCodeAt(0)>=d&&i[0].charCodeAt(0)<=e||i[0].charCodeAt(0)===f);)h.push(i.shift());this.valueStack.push(new a.ExpressionTree(g,new a.ExpressionTree(h.join("")))),j=!0}for(;this.operatorStack.length;)this.valueStack.push(new a.ExpressionTree(this.operatorStack.pop(),this.valueStack.pop(),this.valueStack.pop()))},this.value=function(){return this.valueStack[0].evaluate()},this.evaluate=function(a){return arguments.length&&this.setExpression(a),this.parse(),this.value()},this.setExpression=function(a){this.expression=a,this.operatorStack=[],this.valueStack=[]}},a.ExpressionTree=function(g,h,i){switch(arguments.length){case 1:this.pointer=g,this.left=this.right=this.operator=null;break;case 2:this.pointer=null,this.operator=g,this.left=new a.ExpressionTree(0),this.right=h;break;case 3:this.pointer=null,this.operator=g,this.left=i,this.right=h;break;default:this.pointer=this.left=this.right=this.operator=null}this.evaluate=function(){switch(this.left&&this.left.operator&&this.left.evaluate(),this.right&&this.right.operator&&this.right.evaluate(),this.operator){case"+":this.pointer=this.left.value()+this.right.value();break;case"-":this.pointer=this.left.value()-this.right.value();break;case"*":this.pointer=this.left.value()*this.right.value();break;case"/":this.pointer=this.left.value()/this.right.value()}return this.value()},this.value=function(){return"number"==typeof this.pointer?this.pointer:(this.pointer.charCodeAt(0)>=b&&this.pointer.charCodeAt(0)<=c||this.pointer.charCodeAt(0)===f?this.pointer=parseFloat(this.pointer):this.pointer.charCodeAt(0)>=d&&this.pointer.charCodeAt(0)<=e&&(this.pointer=this.getDomVal()),this.pointer)},this.getDomVal=function(){var a=document.getElementById(this.pointer);return a||(a=document.querySelector("[data-formula-ref='"+this.pointer+"']")),this.getElementValue(a)},this.getElementValue=function(b){var c,d;return b&&b.getAttribute("data-formula")?(d=new a.ExpressionParser(b.getAttribute("data-formula")),c=d.evaluate()):b&&(c=b.innerText),parseFloat(c)}},a.epsilon=function(b){var c,d=new a.ExpressionParser,e=b||document.querySelectorAll("[data-formula]");for(e&&!e.length&&(e=[e]),c=0;e&&c<e.length;c++)e[c].innerText=d.evaluate(e[c].getAttribute("data-formula"))},window.Epsilon=a,a}();