/*! EpsilonJS 2016-03-08 */
Array.prototype.top=function(){return this[this.length-1]};var Epsilon;!function(a){function b(a){var b,c,d=new i,e=a||document.querySelectorAll("[data-formula]");for(void 0===e.length&&(e=new Array(e)),b=0;e&&b<e.length;b++)c=d.evaluate(e[b].getAttribute("data-formula")).toString(),void 0!==e[b].textContent?e[b].textContent=c:e[b].innerText=c}var c=48,d=57,e=65,f=90,g=46,h=function(){function a(b,c,d){switch(this.pointer=null,this.left=null,this.right=null,this.operator=null,arguments.length){case 1:this.pointer=b,this.left=this.right=this.operator=null;break;case 2:this.pointer=null,this.operator=b,this.left=new a(0),this.right=c;break;case 3:this.pointer=null,this.operator=b,this.left=d,this.right=c;break;default:this.pointer=this.left=this.right=this.operator=null}}return a.prototype.evaluate=function(){switch(this.left&&this.left.operator&&this.left.evaluate(),this.right&&this.right.operator&&this.right.evaluate(),this.operator){case"+":this.pointer=this.left.value()+this.right.value();break;case"-":this.pointer=this.left.value()-this.right.value();break;case"*":this.pointer=this.left.value()*this.right.value();break;case"/":this.pointer=this.left.value()/this.right.value()}return this.value()},a.prototype.value=function(){return"number"==typeof this.pointer?this.pointer:(this.pointer.charCodeAt(0)>=c&&this.pointer.charCodeAt(0)<=d||this.pointer.charCodeAt(0)===g?this.pointer=parseFloat(this.pointer):this.pointer.charCodeAt(0)>=e&&this.pointer.charCodeAt(0)<=f&&(this.pointer=this.getDomVal()),this.pointer)},a.prototype.getDomVal=function(){var a=document.getElementById(this.pointer);return a||(a=document.querySelector("[data-formula-ref='"+this.pointer+"']")),this.getElementValue(a)},a.prototype.getElementValue=function(a){var b,c,d=0;return a&&a.getAttribute("data-formula")?(b=new i(a.getAttribute("data-formula")),d=b.evaluate()):a&&a.value?d=parseFloat(a.value)||0:a&&(c=a.textContent||a.innerText,d=parseFloat(c)||0),d},a}();a.ExpressionTree=h;var i=function(){function a(a){this.expr=a,this.expression=null,this.operatorStack=[],this.valueStack=[],this.expression=a}return a.prototype.parse=function(){for(var a,b,c=this.expression.split(""),d=!1;c.length;)if(a=c.shift(),b=[],"("===a)this.operatorStack.push("("),d=!1;else if(")"===a){for(;"("!==this.operatorStack.top();)this.valueStack.push(new h(this.operatorStack.pop(),this.valueStack.pop(),this.valueStack.pop()));this.operatorStack.pop(),d=!0}else if(this.isValueFragment(a)){for(b.push(a);c.length&&this.isValueFragment(c[0]);)b.push(c.shift());this.valueStack.push(new h(b.join(""))),d=!0}else if("-"!==a||d){if(this.isOperator(a)){for(;this.operatorStack.length&&("*"===this.operatorStack.top()||"/"===this.operatorStack.top()||("+"===a||"-"===a)&&("+"===this.operatorStack.top()||"-"===this.operatorStack.top()));)this.valueStack.push(new h(this.operatorStack.pop(),this.valueStack.pop(),this.valueStack.pop()));this.operatorStack.push(a),d=!1}}else{for(;c.length&&this.isValueFragment(c[0]);)b.push(c.shift());this.valueStack.push(new h(a,new h(b.join("")))),d=!0}for(;this.operatorStack.length;)this.valueStack.push(new h(this.operatorStack.pop(),this.valueStack.pop(),this.valueStack.pop()))},a.prototype.isOperator=function(a){return"+"===a||"-"===a||"*"===a||"/"===a},a.prototype.isValueFragment=function(a){return a.charCodeAt(0)>=c&&a.charCodeAt(0)<=d||a.charCodeAt(0)>=e&&a.charCodeAt(0)<=f||a.charCodeAt(0)===g},a.prototype.value=function(){return this.valueStack[0].evaluate()},a.prototype.evaluate=function(a){return arguments.length&&this.setExpression(a),this.parse(),this.value()},a.prototype.setExpression=function(a){this.expression=a,this.operatorStack=[],this.valueStack=[]},a}();a.ExpressionParser=i,a.epsilon=b}(Epsilon||(Epsilon={}));